version: 2.1

orbs:
  gcp-auth: entur/gcp-auth@dev:refactor-gcp-auth # Use volatile if you always want the newest version.

executors:
  entur-cci-toolbox: gcp-auth/entur-cci-toolbox

jobs:
  test-authenticate-gcp:
    executor: entur-cci-toolbox
    steps:
      - checkout
      - gcp-auth/authenticate-gcp
        # using default from context
      - run:
          name: Check that get-value account returns OK
          command: gcloud config get-value account
  test-authenticate-gcp-kubernetes:
    executor: entur-cci-toolbox
    steps:
      - checkout
      - gcp-auth/authenticate-gcp-kubernetes
        # using default from context
      - run:
          name: Check that get-server-config returns OK
          command: gcloud container get-server-config

workflows:
  version: 2.1
  main:
    jobs:
      - test-authenticate-gcp:
          name: GCP Auth
          context: org-devstage-dev
      - test-authenticate-gcp-kubernetes:
          name: GKE Auth
          context: org-devstage-dev
